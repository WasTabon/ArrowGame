# LockPoint Run - Итерация 2

## Бесконечная генерация уровня + Базовая система колец

---

## Что добавлено

### Скрипты:

1. **LevelGenerator.cs** (`Scripts/Level/`) - Бесконечная генерация коридора с пулом объектов
2. **RingConfig.cs** (`Scripts/Ring/`) - ScriptableObject настроек колец
3. **RingController.cs** (`Scripts/Ring/`) - Контроллер вращения кольца
4. **RingSpawner.cs** (`Scripts/Ring/`) - Спавнер колец с пулом объектов
5. **RingPassDetector.cs** (`Scripts/Ring/`) - Детектор прохождения иглы через кольцо

---

## Инструкция по установке

### Шаг 1: Добавить новые скрипты

Скопируй новые файлы в структуру:
```
Assets/ArrowGame/Scripts/
├── Level/
│   └── LevelGenerator.cs
└── Ring/
    ├── RingConfig.cs
    ├── RingController.cs
    ├── RingSpawner.cs
    └── RingPassDetector.cs
```

### Шаг 2: Создать RingConfig

1. ПКМ в папке `ArrowGame/Configs/`
2. Create → ArrowGame → Ring Config
3. Назови файл `RingConfig`

### Шаг 3: Создать префаб кольца

1. Create → 3D Object → Torus (если есть) или используй альтернативу:
   - Create Empty → назови `Ring`
   - Добавь дочерний Cylinder
   - Scale цилиндра: (3, 0.1, 3) — плоский диск
   - Или используй свою модель кольца

2. Для простого теста можно использовать:
   - Create Empty → `Ring`
   - Добавь 4 дочерних Cube как "рамку"
   - Расположи их квадратом с дыркой в центре

3. На родительский объект `Ring` добавь компонент `RingController`

4. Сохрани как префаб в `ArrowGame/Prefabs/Ring.prefab`

5. Удали объект со сцены

### Шаг 4: Настроить LevelGenerator

1. Создай пустой GameObject → назови `LevelGenerator`
2. Добавь компонент `LevelGenerator`
3. Настрой параметры:
   - **Corridor Prefab**: перетащи свой префаб коридора
   - **Segment Length**: 22 (или твоё значение)
   - **First Segment Position**: (0.5, -13.4, 20.6)
   - **Active Segments**: 20
   - **Segments Ahead**: 15
   - **Segments Behind**: 5

4. Удали все существующие сегменты коридора со сцены (они будут создаваться автоматически)

### Шаг 5: Настроить RingSpawner

1. Создай пустой GameObject → назови `RingSpawner`
2. Добавь компонент `RingSpawner`
3. Настрой параметры:
   - **Ring Prefab**: перетащи префаб кольца
   - **Config**: перетащи RingConfig
   - **Pool Size**: 10
   - **Spawn Y**: 0 (высота спавна колец, подбери под свой коридор)
   - **Spawn X**: 0.5 (или центр твоего коридора)

### Шаг 6: Настроить RingPassDetector

1. Создай пустой GameObject → назови `RingPassDetector`
2. Добавь компонент `RingPassDetector`

### Шаг 7: Настроить позицию иглы

Убедись что игла начинает в правильной позиции относительно коридора:
- Position Y: подбери чтобы игла была внутри коридора
- Position X: 0.5 (центр коридора)
- Position Z: 0

---

## Настройки RingConfig

| Параметр | Значение по умолчанию | Описание |
|----------|----------------------|----------|
| Base Rotation Speed | 90 | Начальная скорость вращения (градусы/сек) |
| Max Rotation Speed | 360 | Максимальная скорость вращения |
| Rotation Speed Increase Per Ring | 2 | Увеличение скорости с каждым кольцом |
| Spawn Distance Ahead | 50 | Как далеко вперёд спавнить кольца |
| Min Distance Between Rings | 15 | Минимальное расстояние между кольцами |
| Max Distance Between Rings | 25 | Максимальное расстояние между кольцами |
| Ring Scale | 3 | Размер кольца |
| Spawn Animation Duration | 0.3 | Длительность анимации появления |

---

## Настройки LevelGenerator

| Параметр | Значение | Описание |
|----------|----------|----------|
| Corridor Prefab | твой префаб | Префаб сегмента коридора |
| Segment Length | 22 | Длина сегмента по Z |
| First Segment Position | (0.5, -13.4, 20.6) | Позиция первого сегмента |
| Active Segments | 20 | Сколько сегментов держать активными |
| Segments Ahead | 15 | Сколько сегментов создавать впереди |
| Segments Behind | 5 | Сколько сегментов оставлять позади |

---

## Как тестировать

### Ожидаемый результат:

| Что проверить | Ожидание |
|---------------|----------|
| Запусти Play | Игра стартует без ошибок |
| Коридор генерируется | Коридор появляется впереди иглы по мере движения |
| Коридор удаляется | Старые сегменты исчезают позади (смотри в Hierarchy) |
| Кольца появляются | Кольца спавнятся впереди с анимацией (scale из 0) |
| Кольца вращаются | Каждое кольцо вращается вокруг оси Z |
| Разное направление | Кольца вращаются в разных направлениях |
| Прохождение | При пролёте через кольцо оно реагирует (небольшой scale pulse) |
| Кольца удаляются | Пройденные кольца исчезают позади |
| Бесконечность | Можно лететь бесконечно долго |

### Проверка в Hierarchy:

1. Во время игры открой `LevelGenerator` в Hierarchy
2. Смотри как дочерние объекты (сегменты) появляются и деактивируются
3. То же самое для `RingSpawner` — кольца должны переиспользоваться

### Проверка скорости вращения:

1. Первые кольца вращаются медленно (~90°/сек)
2. С каждым кольцом скорость немного увеличивается
3. Максимум 360°/сек

### Проверка позиционирования:

- Кольца должны быть внутри коридора
- Игла должна пролетать через центр колец
- Если позиции неправильные — подбери Spawn X и Spawn Y в RingSpawner

### Возможные проблемы:

| Проблема | Решение |
|----------|---------|
| Коридор не появляется | Проверь что Corridor Prefab назначен |
| Кольца не появляются | Проверь что Ring Prefab и RingConfig назначены |
| Кольца вне коридора | Подбери Spawn X и Spawn Y |
| Игла вне коридора | Подбери начальную позицию иглы |
| Кольца слишком большие/маленькие | Измени Ring Scale в RingConfig |

---

## Структура файлов итерации

```
ArrowGame/
├── Scripts/
│   ├── Core/
│   │   ├── GameManager.cs
│   │   └── GameConfig.cs
│   ├── Needle/
│   │   └── NeedleController.cs
│   ├── Camera/
│   │   └── CameraController.cs
│   ├── Level/
│   │   └── LevelGenerator.cs (NEW)
│   └── Ring/
│       ├── RingConfig.cs (NEW)
│       ├── RingController.cs (NEW)
│       ├── RingSpawner.cs (NEW)
│       └── RingPassDetector.cs (NEW)
├── Configs/
│   ├── GameConfig.asset
│   └── RingConfig.asset (создать вручную)
├── Prefabs/
│   └── Ring.prefab (создать вручную)
└── Scenes/
    └── Game.unity
```

---

## Иерархия сцены

```
Game (Scene)
├── GameManager
├── LevelGenerator
│   └── (сегменты коридора - создаются автоматически)
├── RingSpawner
│   └── (кольца - создаются автоматически)
├── RingPassDetector
├── Needle
│   └── Visual (Capsule/Cylinder)
└── Main Camera
```

---

## Следующая итерация

В следующей итерации добавим:
- Input: удержание (тач + мышь)
- Плавное замедление вращения кольца при удержании
- Полная остановка при максимальном удержании
